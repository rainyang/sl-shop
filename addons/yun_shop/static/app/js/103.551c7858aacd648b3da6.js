webpackJsonp([103],{"1pHq":function(e,t,o){e.exports=o.p+"static/app/img/agreen_video@2x.9b3a508.png"},"88A/":function(e,t,o){var i=o("gtFf");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);o("rjj0")("24ac2499",i,!0,{})},X3mI:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("mvHQ"),a=o.n(i),s=o("Pexp"),n=o("Tg7E"),r={data:function(){return{file:"",title:"",videoUrl:"",isVideo:!0,realVideo:"",coverUrl:"",duration:0,chooseGoods:null,videoPath:"",videoCover:"",limit:null,uploadIng:!1,videoProgress:0,showUploadBtn:!1,isRirst:!0}},activated:function(){this.init(),this.getList(),this.getPermission(),this.fun.isTextEmpty(JSON.parse(localStorage.getItem("shareVideoPath")))||(this.fun.isTextEmpty(JSON.parse(localStorage.getItem("shareVideoPath")).title)||(this.title=JSON.parse(localStorage.getItem("shareVideoPath")).title),this.fun.isTextEmpty(JSON.parse(localStorage.getItem("shareVideoPath")).videoUrl)||(this.videoUrl=JSON.parse(localStorage.getItem("shareVideoPath")).videoUrl),this.fun.isTextEmpty(JSON.parse(localStorage.getItem("shareVideoPath")).videoUrl)||(this.videoPath=JSON.parse(localStorage.getItem("shareVideoPath")).videoUrl),this.fun.isTextEmpty(JSON.parse(localStorage.getItem("shareVideoPath")).videoCover)||(this.videoCover=JSON.parse(localStorage.getItem("shareVideoPath")).videoCover),this.fun.isTextEmpty(JSON.parse(localStorage.getItem("shareVideoPath")).file_name)||(this.file=JSON.parse(localStorage.getItem("shareVideoPath")).file_name)),void 0!==this.$route.query.goods_id&&null!==this.$route.query.goods_id&&this.getGoodsById()},mounted:function(){},deactivated:function(){},methods:{init:function(){this.title="",this.file="",this.videoUrl="",this.isVideo=!0,this.coverUrl="",this.duration=0,this.chooseGoods=null,this.realVideo="",this.videoPath="",this.videoCover="",this.limit=null,this.uploadIng=!1,this.showUploadBtn=!1,this.isRirst=!0,document.getElementById("file").value=null},getList:function(){var e=this,t=this;$http.get("plugin.video-share.frontend.set.getLimit").then(function(o){1==o.result?e.fun.isTextEmpty(o.data.limit)?t.limit=60:t.limit=o.data.limit:n.MessageBox.alert(o.msg)})},getGoodsById:function(){var e=this;$http.get("plugin.video-share.frontend.goods.getGoodsById",{goods_id:this.$route.query.goods_id}).then(function(t){1==t.result?e.chooseGoods=t.data.goods:n.MessageBox.alert(t.msg)})},gotoAdd:function(){this.$router.push(this.fun.getUrl("addVideoGood",{}))},getPermission:function(){var e=this;$http.get("plugin.video-share.frontend.permission.verify").then(function(t){1==t.result?t.data.ret||(e.$router.push(e.fun.getUrl("VideoList",{})),n.MessageBox.alert(t.msg)):n.MessageBox.alert(t.msg)})},onReadVideo:function(e){console.log(e);var t=e.target.files||e.dataTransfer.files;if(t.length){this.realVideo=t[0],this.videoUrl=null;var o=null;void 0!=window.createObjectURL?o=window.createObjectURL(t[0]):void 0!=window.URL?o=window.URL.createObjectURL(t[0]):void 0!=window.webkitURL&&(o=window.webkitURL.createObjectURL(t[0])),this.videoUrl=o,"ios"==this.fun.isIosOrAndroid()?this.showUploadBtn=!0:this.getDuration()}},play_Upload:function(){this.$refs.video.play(),this.showUploadBtn=!1,this.getDuration()},getDuration:function(){var e=this,t=this.$refs.video;t.src=this.videoUrl,t.addEventListener("loadedmetadata",function(o){return e.duration=t.duration,e.duration<1?(e.videoUrl=null,void n.MessageBox.alert("视频时长太短了！")):e.duration>Number(e.limit)+1?(e.videoUrl=null,void n.MessageBox.alert("视频时长不能超过"+e.limit+"秒")):void e.setSrcAndCaptureImage()})},setSrcAndCaptureImage:function(){var e=this,t=this.$refs.video;t.addEventListener("loadeddata",function o(){var i=document.createElement("canvas");i.width=1*t.videoWidth;i.height=1*t.videoHeight;i.getContext("2d").drawImage(t,0,0,i.width,i.height);e.coverUrl=i.toDataURL("image/png");console.log("肯德基",e.coverUrl);e.uploadAudioM();e.uploadImageM();t.removeEventListener("loadeddata",o)})},autoPlayAudio2:function(){var e=this.$refs.video;e.play(),wx.config({debug:!1,appId:"",timestamp:1,nonceStr:"",signature:"",jsApiList:[]}),wx.ready(function(){e.play()})},BtnMethos:function(){var e=this;if(this.fun.isTextEmpty(this.chooseGoods)){var t={title:this.title,videoUrl:this.videoPath,videoCover:this.videoCover,file_name:this.file};localStorage.setItem("shareVideoPath",a()(t)),this.$router.push(this.fun.getUrl("addVideoGood",{}))}else{if(this.fun.isTextEmpty(this.title))return void Object(n.Toast)("请输入4-18个字标题");if(this.title.length<4)return void n.MessageBox.alert("标题不小于4个字");if(this.fun.isTextEmpty(this.videoUrl))return void Object(n.Toast)("请选择视频进行上传！");if(!this.isRirst)return;this.isRirst=!1;var o={goods_id:this.$route.query.goods_id,title:this.title,video:this.videoPath,cover:this.videoCover,file_name:this.file};$http.post("plugin.video-share.frontend.video.sub",o).then(function(t){1===t.result?(e.isRirst=!0,n.MessageBox.alert(t.msg),localStorage.removeItem("shareVideoPath"),e.$router.push(e.fun.getUrl("VideoList",{from:"release"}))):Object(n.Toast)(t.msg)},function(e){console.log(e)})}},uploadAudioM:function(){this.uploadIng=!0;var e=this,t=this.fun.getRealUrl("plugin.video-share.frontend.upload.uploadAudio",{}),o=new FormData;o.append("file",this.realVideo),axios.post(t,o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){if(1==t.data.result){e.videoPath=t.data.data.audio_url,e.file=t.data.data.file_name,e.uploadIng=!1;var o={title:e.title,videoUrl:e.videoPath,videoCover:e.videoCover,file_name:e.file};localStorage.setItem("shareVideoPath",a()(o))}else e.uploadIng=!1,Object(n.Toast)(t.data.msg)}).catch(function(t){e.uploadIng=!1,console.log(t)})},uploadImageM:function(){var e=this,t=this.fun.getRealUrl("plugin.video-share.frontend.upload.upload",{}),o=new FormData;console.log("麦当劳",this.dataURItoBlob(this.coverUrl)),o.append("file",this.dataURItoBlob(this.coverUrl)),axios.post(t,o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){1==t.data.result?e.videoCover=t.data.data.img_url:Object(n.Toast)(t.data.msg)}).catch(function(e){console.log(e)})},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),a=new Uint8Array(i),s=0;s<t.length;s++)a[s]=t.charCodeAt(s);return new Blob([i],{type:o})}},components:{cTitle:s.a}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"releaseVideo"}},[i("c-title",{attrs:{hide:!1,text:"发布视频",url:"VideoList"}}),e._v(" "),i("div",{staticClass:"content"},[i("van-cell-group",{staticClass:"settitle"},[i("van-field",{attrs:{placeholder:"标题：请输入标题，4-18个字",maxlength:"18"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),e._v(" "),i("div",{staticClass:"video-wrap"},[i("video",{directives:[{name:"show",rawName:"v-show",value:e.videoUrl,expression:"videoUrl"}],ref:"video",staticStyle:{background:"#ffffff"},attrs:{preload:"metadata",controlslist:"nodownload",width:"100%",height:"100%",controls:"","webkit-playsinline":"true","x5-video-player-type":"h5",playsinline:"","x5-playsinline":"","x5-video-orientation":"portrait","x5-video-player-fullscreen":"",autoplay:"autoplay",src:e.videoUrl,id:"video"}},[i("source",{attrs:{src:e.videoUrl,type:"video/ogg"}}),e._v(" "),i("source",{attrs:{src:e.videoUrl,type:"video/mp4"}}),e._v("\n        你的浏览器不支持video标签！\n      ")]),e._v(" "),i("img",{directives:[{name:"show",rawName:"v-show",value:!e.videoUrl,expression:"!videoUrl"}],staticClass:"back_img",attrs:{src:o("1pHq"),alt:""}}),e._v(" "),i("input",{directives:[{name:"show",rawName:"v-show",value:!e.videoUrl,expression:"!videoUrl"}],staticClass:"video-input",attrs:{type:"file",id:"file",accept:"video/*"},on:{change:e.onReadVideo}})]),e._v(" "),i("p",{staticStyle:{margin:"0.25rem 1rem","text-align":"left",color:"#757575"}},[e._v("视频时长不应超过"),i("small",{staticStyle:{color:"#FFC107","font-size":"14px"}},[e._v(e._s(e.limit))]),e._v("秒")]),e._v(" "),this.fun.isTextEmpty(this.chooseGoods)?e._e():i("span",{staticClass:"changeGoodClass",on:{click:e.gotoAdd}},[e._v("更换商品")])],1),e._v(" "),this.fun.isTextEmpty(this.chooseGoods)?e._e():i("div",{staticClass:"goood-class"},[i("img",{attrs:{src:e.chooseGoods.thumb,alt:""}}),e._v(" "),i("div",{staticClass:"right-class"},[i("p",[e._v(e._s(e._f("escapeTitle")(e.chooseGoods.title)))]),e._v(" "),i("div",{staticClass:"price"},[i("span",{staticClass:"now-price"},[e._v("￥"+e._s(e.chooseGoods.price))]),e._v(" "),i("span",{staticClass:"old-price"},[e._v("原价：¥"+e._s(e.chooseGoods.market_price))])])])]),e._v(" "),i("div",{staticStyle:{height:"2.8125rem"}}),e._v(" "),i("div",{staticClass:"bottomBtn",style:{width:3==this.fun.getPhoneEnv()?"375px":"100%"}},[i("span",{directives:[{name:"show",rawName:"v-show",value:!e.showUploadBtn&&!e.uploadIng,expression:"!showUploadBtn&&!uploadIng"}],on:{click:e.BtnMethos}},[e._v(e._s(this.fun.isTextEmpty(this.chooseGoods)?"添加商品":"确认发布")+"\n    ")]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:e.showUploadBtn,expression:"showUploadBtn"}],on:{click:e.play_Upload}},[e._v("上传视频")]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!e.showUploadBtn&&e.uploadIng,expression:"!showUploadBtn&&uploadIng"}],staticStyle:{"background-color":"#7d7e80"}},[e._v("视频上传中...\n    ")])])],1)},staticRenderFns:[]};var d=o("VU/8")(r,l,!1,function(e){o("88A/")},"data-v-e02506ba",null);t.default=d.exports},gtFf:function(e,t,o){(e.exports=o("FZ+f")(!1)).push([e.i,"\n#releaseVideo .content[data-v-e02506ba] {\n  padding-top: 40px;\n  background: #ffffff;\n  padding-bottom: 1rem;\n  overflow: hidden;\n}\n#releaseVideo .content .settitle[data-v-e02506ba] {\n    margin: 1rem 0;\n}\n#releaseVideo .content .settitle[data-v-e02506ba]::after {\n    border: none;\n}\n#releaseVideo .content .video-wrap[data-v-e02506ba] {\n    width: 90%;\n    height: 14.19rem;\n    position: relative;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    margin: 0 auto;\n    background: #fafafa;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    overflow: hidden;\n}\n#releaseVideo .content .video-wrap .back_img[data-v-e02506ba] {\n      width: 5rem;\n      height: 5rem;\n}\n#releaseVideo .content .video-wrap .video-guide[data-v-e02506ba] {\n      position: absolute;\n      color: #ffffff;\n}\n#releaseVideo .content .video-wrap .video-input[data-v-e02506ba] {\n      width: 100%;\n      position: absolute;\n      left: 0;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      opacity: 0;\n}\n#releaseVideo .content .changeGoodClass[data-v-e02506ba] {\n    display: inline-block;\n    width: 14.38rem;\n    height: 2.5rem;\n    font-size: 1rem;\n    color: #f15353;\n    line-height: 2.5rem;\n    margin-top: 1.88rem;\n    border-radius: 0.25rem;\n    border: solid 0.0625rem #f15353;\n}\n#releaseVideo .goood-class[data-v-e02506ba] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  margin: 0.63rem 0.94rem 3.94rem;\n  background: #ffffff;\n}\n#releaseVideo .goood-class img[data-v-e02506ba] {\n    width: 3.75rem;\n    height: 3.75rem;\n    margin: 0.63rem;\n}\n#releaseVideo .goood-class .right-class[data-v-e02506ba] {\n    -webkit-box-flex: 1;\n        -ms-flex: 1;\n            flex: 1;\n    overflow: hidden;\n    padding: 0.63rem 0.63rem 0.63rem 0;\n}\n#releaseVideo .goood-class .right-class p[data-v-e02506ba] {\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      width: 100%;\n      text-align: left;\n      margin-bottom: 0.81rem;\n      color: #333333;\n      font-size: 15px;\n}\n#releaseVideo .goood-class .right-class .price[data-v-e02506ba] {\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n      -webkit-box-align: center;\n          -ms-flex-align: center;\n              align-items: center;\n}\n#releaseVideo .goood-class .right-class .price .now-price[data-v-e02506ba] {\n        font-size: 1rem;\n        color: #f15353;\n        margin-right: 1.19rem;\n}\n#releaseVideo .goood-class .right-class .price .old-price[data-v-e02506ba] {\n        font-size: 0.75rem;\n        color: #8c8c8c;\n}\n#releaseVideo .bottomBtn[data-v-e02506ba] {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  height: 3.31rem;\n  background: #ffffff;\n  border-top: solid 0.0625rem #ebebeb;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n#releaseVideo .bottomBtn span[data-v-e02506ba] {\n    display: inline-block;\n    width: 100%;\n    height: 2.5rem;\n    line-height: 2.5rem;\n    background-color: #f15353;\n    border-radius: 0.25rem;\n    margin: 0.34rem 0.94rem;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n    font-size: 1rem;\n    color: #ffffff;\n}\n",""])}});